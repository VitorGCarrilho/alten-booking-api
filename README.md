# alten-booking-service


## CHALLENGE
Post-Covid scenario:

People are now free to travel everywhere but because of the pandemic, a lot of hotels went
bankrupt. Some former famous travel places are left with only one hotel.
You’ve been given the responsibility to develop a booking API for the very last hotel in Cancun.
The requirements are:
- API will be maintained by the hotel’s IT department.
- As it’s the very last hotel, the quality of service must be 99.99 to 100% => no downtime
- For the purpose of the test, we assume the hotel has only one room available
- To give a chance to everyone to book the room, the stay can’t be longer than 3 days and
  can’t be reserved more than 30 days in advance.
- All reservations start at least the next day of booking,
- To simplify the use case, a “DAY’ in the hotel room starts from 00:00 to 23:59:59.
- Every end-user can check the room availability, place a reservation, cancel it or modify it.
- To simplify the API is insecure.

## SOLUTION

![Alt text](readme-resources/solution-diagram.jpg?raw=true "Title")

The alten-booking-servce have the proposal of been 100% available, so every 
decision made here was thinking on that premise.

The main choice here was to adopt Availability and Partition Tolerance over consistency (According to 
the CAP theorem we can only choose 2). 

On Get Apis like `/api/v1/availability` (booking dates availability) we are not depending only from the databases! 
For each new request on the SQL database, a cache is saved in Redis (If Redis is not available it is ignored). 
We are using the <a href="https://github.com/Netflix/Hystrix" target="_blank">Neflix Hystrix</a> for 
making our api fault tolerant, so if the database is not available the Circuit Breaker will return the data 
from the cache on redis (Note that this data could not be the latest version because we are choosing 
availability over consistency).

On the booking apis (POST, PUT, DELETE) we are not writing directly to the database. The databases have 
finite I/O resource so this could be a bottleneck. In the Worst scenario too many requests could be done in 
the same time, and the I/O on the database takes sometime making all treads unavailable (We are expecting that because 
we are the very last hotel in Cancun, so we can expect people from all over the world trying to book). 
To avoid this I/O issues we are creating events on <a href="https://kafka.apache.org/" target="_blank">Apache kafka</a> 
(distributed, fault-tolerant, scalable event streaming platform) who can stream a lot of data per unit of time. 
The api returns Accepted http status so the end user can see that the booked request was received but not confirmed yet.
This approach (process the book asynchronously) also avoid unavailability for the end user if the database 
is unavailable.  

The Consumers receive the event and tries to make the book request. If some errors occurs like the database is 
not available, the consumer will try it again (for 10 times waiting 1 second with a multiplayer of 2 for each try 
before sending it to a dlq). The book can be accepted or denied If it is already booked by someone else (Consistency 
problem that we can have when we choose availability) for both of the cases we need to give this feedback to the user so
we are producing a notification event that will send an e-mail for the end user with the feedback (this event will have 
retries policies like the one above).

## Run locally

To make our lives easier, we are using docker and docker compose to generate all infrastructure on local containers. 
You just need to run the command:
```` 
docker-compose up
````

This command will start up the mysql database, the kafka cluster and the redis.

After that you just need to run:
```` 
mvn spring-boot:run
````

## Api Documentation

All the api docs is being generated by swagger and can be found on `/swagger-ui.html`

![Alt text](readme-resources/swagger.PNG?raw=true "Title")

## Concurrence

## Database

## Apache Kafka

## Redis

## Feedback

As described before, we need to give a feedback to the user after our end user. Here is some example of the feedback:

![Alt text](readme-resources/email-example.PNG?raw=true "Title")
